(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[68069],{268536:(e,t,i)=>{i.d(t,{Z:()=>v});var n=i(27255),r=i(124580),o=i(172071),a=i(115535),s=i(402039),d=i(638525),u=i(12610),p=i(305689);function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const l=(0,p.ZP)();let _=null;class h{static getInstance(){return _||(_=new h),_}constructor(){c(this,"_logTimeoutLong",null),c(this,"_logTimeoutShort",null),c(this,"_moduleViewElements",{}),c(this,"_scrollListeners",{}),c(this,"_clickthroughStartEvent",null),c(this,"_utcDate",new Date);const e=(e,t)=>{const{activeElement:i}=document;i&&i.id===n.Z.VIDEO_IFRAME_ID&&i?setTimeout((()=>i.blur()),0):(r.Z.pause(u.LU),this.flushEvents(e,void 0))},t=(e=>{let t=!1;return(...i)=>{t||(t=!0,e(...i))}})((t=>e(!0)));window.addEventListener("beforeunload",t),window.addEventListener("pagehide",t),window.addEventListener("focus",(()=>{r.Z.resume(u.LU)})),window.addEventListener("blur",(t=>e(!1)))}_handleDatelineCrossover(){const e=new Date;this._utcDate.getUTCDate()!==e.getUTCDate()&&(this._utcDate=e,(0,a.Z)())}setTimeoutToFlushEvents(e){const t=e.event_type;if(h.EVENTS_FAST_FLUSH.includes(e.view_type)&&!this._logTimeoutShort&&13===t)this._logTimeoutShort=s.Z.setTimeout(this.flushEvents.bind(this,!1,!0),h.FLUSH_INTERVAL_SHORT);else if(!this._logTimeoutLong){const e=h.FLUSH_INTERVAL_LONG;this._logTimeoutLong=s.Z.setTimeout(this.flushEvents.bind(this),e)}}addEvent(e,t){const i=e.event_type;if(null==i)return;if(!(0,p.cA)(e))return;this.setTimeoutToFlushEvents(e);const n=(0,p.li)(e,t),r=p.Ch[i];r?(0,p.nc)(n,r).forEach(l.logImpression):(o.Z.increment("webapp.contextLogger.impressionType",.01,{event_type:i}),l.logContextEvent(n),this._handleDatelineCrossover(),12===i&&(l.logContextEvent({...n,event_type:7946}),this._clickthroughStartEvent={...n,time:1e6*Date.now()},d.Z.storeClickthroughProperties({view_type:n.view_type,view_parameter:n.view_parameter,component:n.component,element:n.element,object_id_str:n.object_id_str,view_data:n.view_data,aux_data:n.aux_data,clientTrackingParams:n.clientTrackingParams})))}flushEvents(e,t){var i;const n=null===(i=l.getContextEvents)||void 0===i?void 0:i.call(l);n&&!n.length||(this._handleDatelineCrossover(),l.flushContextEvents(e),t?this._resetShortTimerEvents():this._reset())}_reset(){this._resetShortTimerEvents(),this._resetLongTimerEvents()}_resetShortTimerEvents(){var e;null===(e=l.resetEventsBuffer)||void 0===e||e.call(l),clearTimeout(this._logTimeoutShort),this._logTimeoutShort=null}_resetLongTimerEvents(){var e;null===(e=l.resetEventsBuffer)||void 0===e||e.call(l),clearTimeout(this._logTimeoutLong),this._logTimeoutLong=null}logPlainObject(e){"event_type"in e&&this.addEvent({...e,..."aux_data"in e?{aux_data:{...e.aux_data}}:null})}}c(h,"FLUSH_INTERVAL_LONG",1e4),c(h,"FLUSH_INTERVAL_SHORT",300),c(h,"EVENTS_FAST_FLUSH",[9,3]),window.addEventListener&&window.addEventListener("focus",(()=>{const e=h.getInstance();if(e._clickthroughStartEvent){const t=e._clickthroughStartEvent;e._clickthroughStartEvent=null;const i={...t,event_type:4100,duration_ns:(0,p.h1)()-t.time};e.addEvent(i)}}));const v=h},638525:(e,t,i)=>{i.d(t,{Z:()=>p});var n=i(268536),r=i(768559),o=i(704115),a=i(927955),s=i(433780);const d={},u=(0,o.Z)()&&(0,o.Z)().debug_timespent,p=(0,s.Z)({flushEvents:e=>{n.Z.getInstance().flushEvents(e,void 0)},shouldShowLogStatements:u,track:(e,t)=>{const i=n.Z.getInstance(),o=a.Z.instance.getState();let s;if(o.pins&&e){const{pair_id:i,event_type:n}=e;if(4703===n&&i&&d[i])e.clientTrackingParams=d[i];else{var u;const a=e.object_id_str,p=a?o.pins[a]:null,c=null==t||null===(u=t.current)||void 0===u?void 0:u.location,l=null==t?void 0:t.previous;p&&c&&(s=(0,r.Z)(p,c,l)||`${p.tracking_params||""}~0`,e.clientTrackingParams=s,4702===n&&i&&(d[i]=s))}}i.addEvent(e)}})},305689:(e,t,i)=>{i.d(t,{Ch:()=>c,nc:()=>w,ZP:()=>f,cA:()=>m,li:()=>g,h1:()=>u});var n=i(682492),r=i.n(n),o=i(6637),a=i(706922);var s=i(385740),d=i(172045);const u=()=>1e6*Date.now(),p=[6945],c={3829:"articleImpressions",18:"pinImpressions",3700:"boardImpressions",3803:"searchImpressions",170:"storyImpressions",3704:"userImpressions"},l=[4700,4701,4702,4703,7042,7043],_=e=>function(e){let t=e.length;for(let i=e.length-1;i>=0;i-=1){const n=e.charCodeAt(i);n>127&&n<=2047?t+=1:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&(i-=1)}return t}(JSON.stringify(e)),h=e=>p.includes(e);function v(e){return e.reduce(((e,t)=>{const i=e.find((n=t,e=>e.view_type===n.viewType&&e.view_parameter===n.viewParameter&&e.event_type===n.eventType&&e.object_id_str===n.objectIdStr&&(0,a.Z)(e.view_data,n.viewData)));var n;if(i&&!h(t.eventType))t.impressionType in i.event_data?i.event_data[t.impressionType].push(t.eventData):i.event_data[t.impressionType]=[t.eventData];else{const i={event_type:t.eventType,view_parameter:t.viewParameter,view_type:t.viewType,view_data:t.viewData,time:u(),component:t.component,clientUUID:(0,d.Z)(),aux_data:t.auxData||{},event_data:{[t.impressionType]:h(t.eventType)?t.eventData:[t.eventData]},object_id_str:t.objectIdStr||void 0};e.push(i)}return e}),[])}const m=e=>{const t=e.event_type,i=l.includes(t),n=(0,s.BE)();return!(!i&&13!==t&&!n)},g=(e,t)=>{const i=e.event_type,n=l.includes(i),o=(0,s.BE)();return n?e:13===i&&e.view_type?(null==t||t({viewType:e.view_type,viewParameter:e.view_parameter,viewData:null!=o&&o.viewData?r()(o.viewData,e.view_data):r()({},e.view_data)}),e):!o||e.view_type&&e.view_parameter?e:{...e,view_type:o.viewType,view_parameter:o.viewParameter,view_data:e.view_data?r()(e.view_data,o.viewData):r()({},o.viewData)}},w=(e,t)=>{var i,n;const r=e.component,o=e.object_id_str,a=e.view_type,s=e.event_type;return null!==(i=((null===(n=e.event_data)||void 0===n?void 0:n[t])||[]).map((i=>({auxData:e.aux_data,...r?{component:r}:{},eventData:i,...s?{eventType:s}:{},...a?{viewType:a}:{},viewData:e.view_data,viewParameter:e.view_parameter,...o?{objectIdStr:o}:null,impressionType:t}))))&&void 0!==i?i:[]};function f(){let e=[],t=[],i=0;function n(){return[...e,...v(t)]}function r(){e=[],t=[],i=0}function a(e=!1){const t=n();t.length&&(o.ZP.create("ContextLogResource",{events:t,report_time:u()}).callCreate({async:!e,showError:!1}),r())}return{flushContextEvents:a,getContextEvents:n,logContextEvent:function(t){const n={aux_data:{},event_data:{},view_data:{},...t,time:u(),clientUUID:(0,d.Z)()};i+_(n)>20480&&a(!1),e.push(n)},logImpression:function(e){i+_(e)>20480&&a(!1),t.push(e)},resetEventsBuffer:r}}},433780:(e,t,i)=>{i.d(t,{Z:()=>u});var n=i(172071),r=i(245474);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const a="ACTIVE",s="PAUSED",d=()=>window&&window.performance&&window.performance.now?`(Time: ${(window.performance.now()/1e3).toFixed(3)}s)`:"",u=({flushEvents:e,shouldShowLogStatements:t=!1,track:i})=>{const u=new Map,p=t?console:{error:(...e)=>{},log:(...e)=>{},group:(...e)=>{},groupEnd:(...e)=>{}};console.group||(p.group=(...e)=>console.log(...e),p.groupEnd=(...e)=>{});return new class{constructor(){o(this,"appTimedPair",null),o(this,"clickthroughProperties",null),o(this,"historyStackContext",null),o(this,"offsiteTimedPair",null),o(this,"offsiteTimedPairForegroundId",null),o(this,"addEventListeners",(()=>{let e,t;"undefined"!==document.hidden?(e="hidden",t="visibilitychange"):"undefined"!==document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange");const i=t=>{document[e]?this.unregisterApp(!1,void 0,t):document.hasFocus()&&this.registerApp()};t&&document.addEventListener(t,i,!1),window.addEventListener("focus",this.registerApp),window.addEventListener("blur",(e=>this.unregisterApp(!1,void 0,e)));const r=(e=>{let t=!1;return(...i)=>{t||(t=!0,e(...i))}})((e=>this.unregisterApp(!0,void 0,e)));window.addEventListener("beforeunload",r),window.addEventListener("pagehide",r);const o=navigator&&navigator.userAgent.toLowerCase();o&&o.includes("macintosh")&&o.includes("chrome")&&window.addEventListener("popstate",(t=>{document.hasFocus()||document[e]||n.Z.increment("chrome_mac_back_forward_button",1)}))})),o(this,"storeClickthroughProperties",(e=>{this.clickthroughProperties&&n.Z.increment("webapp.metrics.clickthroughs.overwritten",1,{previousView:this.clickthroughProperties.view_type,previousViewParameter:this.clickthroughProperties.view_parameter,nextView:e.view_type,nextViewParameter:e.view_parameter}),this.clickthroughProperties=e})),o(this,"clearClickthroughProperties",(()=>{this.clickthroughProperties=null,this.offsiteTimedPair=null,this.offsiteTimedPairForegroundId=null})),o(this,"registerApp",(()=>{p.group("App Foreground",d()),null==this.appTimedPair?(this.appTimedPair=new r.Z,this.appTimedPair.start(),this._unpauseAllComponents(),this._endOffsiteTimedPair(),null!==this.appTimedPair&&void 0!==this.appTimedPair&&i({event_type:4700,pair_id:this.appTimedPair.uuid},this.historyStackContext)):p.error("TimedPair already exists for app."),p.groupEnd()})),o(this,"unregisterApp",((t=!1,n=!1,r)=>{p.group("App Background",d());const o=this.appTimedPair;if(null!=o){this._pauseAllComponents();const e=o.end();this._startOffsiteTimedPair(),i({event_type:4701,duration_ns:e,pair_id:o.uuid},this.historyStackContext),this.appTimedPair=null}else p.error("No TimedPair found for app.");const a=["beforeunload","pagehide"],s=a.includes(null==r?void 0:r.type),u=a.includes(null==r?void 0:r.pauseReason);(s||u)&&this._endOffsiteTimedPair(),n||e(null!=t&&t,void 0,r),p.groupEnd()})),o(this,"_activateComponent",(e=>{p.group("Activating component",d()),t&&p.log(e.getContext());const n=e.getTimedPair();if(n){n.start();const{view:t,viewParameter:r,component:o,element:a,objectId:s,clientTrackingParams:d}=e.getLoggerContext();i({event_type:4702,view_type:t,view_parameter:r,component:o,element:a,object_id_str:s,view_data:e.props.viewData,pair_id:n.uuid,clientTrackingParams:d,aux_data:{time_spent_foreground_pairid:this.appTimedPair&&this.appTimedPair.uuid,time_spent_parent_pairid:e.getParentId(),...e.props.auxData}},this.historyStackContext)}p.groupEnd()})),o(this,"_deactivateComponent",(e=>{p.group("Deactivating component",d()),t&&p.log(e.getContext());const n=e.getTimedPair();if(n){const{view:t,viewParameter:r,component:o,element:a,objectId:s,clientTrackingParams:d}=n,u=n.end();i({event_type:4703,view_type:t,view_parameter:r,component:o,element:a,object_id_str:s,view_data:e.props.viewData,duration_ns:u,pair_id:n.uuid,clientTrackingParams:d,aux_data:{time_spent_foreground_pairid:this.appTimedPair&&this.appTimedPair.uuid,time_spent_parent_pairid:e.getParentId(),...e.props.auxData}},this.historyStackContext)}p.groupEnd()})),o(this,"_startOffsiteTimedPair",(()=>{const{clickthroughProperties:e}=this;e&&(this.offsiteTimedPair=new r.Z({...e,view:186,viewParameter:e.view_parameter,objectId:e.object_id_str}),this.offsiteTimedPair.start(),this.offsiteTimedPairForegroundId=this.appTimedPair?this.appTimedPair.uuid:null,i({...e,event_type:4702,view_type:186,pair_id:this.offsiteTimedPair?this.offsiteTimedPair.uuid:null,aux_data:{...e.aux_data,time_spent_foreground_pairid:this.offsiteTimedPairForegroundId}},this.historyStackContext))})),o(this,"_endOffsiteTimedPair",(()=>{const{offsiteTimedPair:e,clickthroughProperties:t}=this;if(e&&t){const n=e.end();i({...t,event_type:4703,view_type:186,pair_id:this.offsiteTimedPair?this.offsiteTimedPair.uuid:null,aux_data:{...t.aux_data,time_spent_foreground_pairid:this.offsiteTimedPairForegroundId},duration_ns:n},this.historyStackContext),this.clearClickthroughProperties()}})),o(this,"_pauseAllComponents",(()=>{p.group("Pause all components"),u.forEach(((e,t,i)=>{e===a&&this._deactivateComponent(t),i.set(t,s)})),p.groupEnd()})),o(this,"_unpauseAllComponents",(()=>{p.group("Unpause all components"),u.forEach(((e,t)=>{t.setTimedPair(new r.Z(t.getLoggerContext()))})),u.forEach(((e,t)=>{u.set(t,a),this._activateComponent(t)})),p.groupEnd()}))}setHistoryStackContext(e){this.historyStackContext=e}registerComponent(e){null===this.appTimedPair?u.set(e,s):(u.set(e,a),this._activateComponent(e))}unregisterComponent(e){u.get(e)===a&&(this._deactivateComponent(e),e.setTimedPair(new r.Z(e.getLoggerContext()))),u.delete(e)}size(){return u.size}}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/68069-3ed1921481404521.mjs.map